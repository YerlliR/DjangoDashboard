{% extends 'base.html' %}

{% block content %}

    {% if user.is_authenticated %}

        <div class="container">
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-title">Total Balnce</div>
                    <div class="metric-value">$47,582.34</div>
                    <div class="metric-change positive">
                        <i class="fas fa-arrow-up"></i> +5.17%
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">Profit/Loss</div>
                    <div class="metric-value">+$8,234.56</div>
                    <div class="metric-change positive">
                        <i class="fas fa-arrow-up"></i> +20.87%
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">Total Invest</div>
                    <div class="metric-value">$39,347.78</div>
                    <div class="metric-change">
                        <i class="fas fa-coins"></i> Invertido
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">24h Change</div>
                    <div class="metric-value">+$2,341.23</div>
                    <div class="metric-change positive">
                        <i class="fas fa-arrow-up"></i> +5.17%
                    </div>
                </div>
            </div>

            <!-- <div class="charts-grid">
                <div class="chart-container">
                    <h3 class="chart-title">Distribución de Portfolio</h3>
                    <div class="doughnut-container">
                        <div class="doughnut-mock"></div>
                        <div class="doughnut-legend">
                            <div class="legend-item">
                                <div class="legend-color bitcoin"></div>
                                <span>Bitcoin (47.6%)</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color ethereum"></div>
                                <span>Ethereum (31.4%)</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color cardano"></div>
                                <span>Cardano (11.8%)</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color solana"></div>
                                <span>Solana (5.7%)</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color polygon"></div>
                                <span>Polygon (3.8%)</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="chart-container">
                    <h3 class="chart-title">Rendimiento del Portfolio (30 días)</h3>
                    <div class="line-chart-mock">
                        <div class="chart-grid"></div>
                        <div class="line-path"></div>
                    </div>
                </div>
            </div> -->

            <div class="holdings-table">
                <div class="holdings-table-header">
                    <h3 class="chart-title">Mis Tenencias</h3>

                    <button class="add-crypto-button">Add Crypto</button>
                </div>

                <table>
                    <thead>
                        <tr>
                            <th>NAME</th>
                            <th>PRICE</th>
                            <th>QUANTITY</th>
                            <th>MEDIUM PRICE</th>
                            <th>VALUE</th>
                            <th>PROFIT</th>
                            <th>% PROFIT</th>
                            <th>ACTIONS</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for crypto in user_crypto_list %}

                            <tr>
                                <td>
                                    <span><img class="logo-crypto" src="{{ crypto.crypto_logo }}" alt="logo-{{ crypto.crypto_name }}"></span>
                                    <span class="crypto-name">{{ crypto.crypto_name }}</span>
                                    <span class="crypto-symbol">{{ crypto.crypto_symbol }}</span>
                                </td>
                                <td class="price">
                                    {{ crypto.crypto_price }}
                                </td>
                                <td class="amount">
                                    {{ crypto.amount }}
                                </td>
                                <td class="value">
                                    {{ crypto.medium_price }}
                                </td>
                                <td class="value">
                                    {{ crypto.value }}
                                </td>
                                <td class="profit">
                                    {{ crypto.profit }}
                                </td>
                                <td class="percentage-profit">
                                    {{ crypto.percentage_profit }} %
                                </td>
                                <td class="actions">
                                    <a href="" class="table-button table-shoping">
                                        <i class="fa-solid fa-cart-shopping"></i>
                                    </a>
                                    <a href="" class="table-button table-view">
                                        <i class="fa-solid fa-eye"></i>
                                    </a>
                                </td>
                            </tr>
                        {% empty %}
                            <tr>
                                <td colspan="7" class="no-results">
                                    No hay criptomonedas disponibles
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

    
    {% else %}

        <div class="alert-login-container">
            <div class="login-wrapper">
                <div class="login-card">
                    <div class="login-icon">
                        <i class="fas fa-wallet"></i>
                    </div>
                    
                    <h1>Acceso a Wallet</h1>
                    
                    <div class="login-message">
                        <p>Para disfrutar de todas las funciones de <strong>BitPy</strong> y gestionar tu cartera de criptomonedas, necesitas iniciar sesión primero.</p>
                    </div>

                    <div class="features-list">
                        <h3>Con tu cuenta podrás:</h3>
                        <ul>
                            <li>
                                <i class="fas fa-wallet"></i>
                                Crear y gestionar múltiples wallets
                            </li>
                            <li>
                                <i class="fas fa-chart-line"></i>
                                Hacer seguimiento de tus inversiones
                            </li>
                            <li>
                                <i class="fas fa-history"></i>
                                Ver historial de transacciones
                            </li>
                            <li>
                                <i class="fas fa-bell"></i>
                                Recibir alertas de precio
                            </li>
                        </ul>
                    </div>
                    <a href="/login">
                        <button type="submit" class="login-btn">
                            <i class="fas fa-sign-in-alt"></i>
                            Iniciar Sesión
                        </button>
                    </a>

                    <div class="back-home">
                        <a href="{% url 'index' %}" class="back-btn">
                            <i class="fas fa-arrow-left"></i>
                            Volver al inicio
                        </a>
                    </div>
                </div>
            </div>
        </div>

    {% endif %}


    <div class="add-crypto-modal">
        <div class="modal-container">
            <button class="modal-close">
                <i class="fas fa-times"></i>
            </button>

            <h1 class="add-crypto-title">
                Agregar Criptomonedas
            </h1>

            <form action="{% url 'wallet_detail' wallet.id %}" method="POST">
                {% csrf_token %}

                <label for="crypto_select">Crypto</label>
                <select name="crypto_select" id="crypto_select">

                    {% for crypto in crypto_list %}
                        <option value="{{ crypto.id }}">{{ crypto.name }} - {{ crypto.symbol }}</option>
                    {% endfor %}

                </select>

                <label for="amount">Quantity</label>
                <input type="text" name="amount" id="amount" placeholder="Amount">

                <label for="price">Price</label>
                <input type="text" name="price" id="price" placeholder="Price">

                <label for="date">Transacion Date</label>
                <input type="date" name="date" id="date">
                
                <button type="submit" class="submit-btn">
                    <i class="fas fa-paper-plane"></i> Submit
                </button>

            </form>
        </div>
    </div>
{% endblock %}

{% block extra_js %}

    <script>

        // FUNCIONABILIDADADES DE LA PAGINA
        document.addEventListener('DOMContentLoaded', function() {
            const features = document.querySelectorAll('.features-list li');
            features.forEach((feature, index) => {
                feature.style.animationDelay = `${0.1 * index}s`;
                feature.style.animation = 'fadeInUp 0.close-modal6s ease-out forwards';
            });
            
            const authBtns = document.querySelectorAll('.auth-btn');
            authBtns.forEach(btn => {
                btn.addEventListener('mouseenter', function() {
                    this.style.transform = 'translateY(-2px) scale(1.02)';
                });
                
                btn.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0) scale(1)';
                });
            });
            close-modal
            document.getElementById('github-login').addEventListener('click', function(e) {
                e.preventDefault();
                alert('Funcionalidad de GitHub OAuth en desarrollo...');
            });
            
            document.getElementById('google-login').addEventListener('click', function(e) {
                e.preventDefault();
                alert('Funcionalidad de Google OAuth en desarrollo...');
            });
        });


        // FUNCIONABILIDADES VENTANA MODAL
        const addCryptoBtn = document.querySelector('.add-crypto-button');
        const closeModalBtn = document.querySelector('.modal-close');

        // Abrir modal
        addCryptoBtn.addEventListener('click', function(e) {

            e.preventDefault();
            document.querySelector('.add-crypto-modal').classList.add('active');
        });

        // Cerrar modal
        closeModalBtn.addEventListener('click', function(e) {
            e.preventDefault();
            document.querySelector('.add-crypto-modal').classList.remove('active');
        });


    </script>
{% endblock %}